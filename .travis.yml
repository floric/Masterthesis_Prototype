language: node_js
env:
  global:
  - CC_TEST_REPORTER_ID=fc64d003bdf120b91db2a980408cf2073efe351171845840b1fa6a0d87b658ea
node_js:
- '10'
cache:
  yarn: true
  directories:
  - "$HOME/.mongodb-binaries"
before_install:
- curl -o- -L https://yarnpkg.com/install.sh | bash
- export PATH="$HOME/.yarn/bin:$PATH"
- yarn global add greenkeeper-lockfile@1
before_script:
- greenkeeper-lockfile-update
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
script:
- yarn build
- cd packages/shared
- yarn test
- cd ../backend
- yarn test
after_script:
- cd packages/shared
- "../../cc-test-reporter format-coverage -o /tmp/codeclimate.shared.json"
- cd ../backend
- "../../cc-test-reporter format-coverage -o /tmp/codeclimate.backend.json"
- cd ../../
- "./cc-test-reporter sum-coverage /tmp/codeclimate.*.json -p 2 -o tmp/codeclimate.total.json"
- "./cc-test-reporter upload-coverage -i tmp/codeclimate.total.json"
- greenkeeper-lockfile-upload
deploy:
  provider: s3
  access_key_id: AKIAIBSSFFPSS7O4XW3A
  secret_access_key:
    secure: Jn4Sdt1kVM2ChAF1cEcPBedZYk7GaIajSoFbhOQs5Nx2s7rKgT3y5KR+EDSJSdWFwidvFdsEAAOIcROyRK2hmk5FWhr6GrSyocRLfCCUFB2CuENrE2GxReHM1eQEr6w7s6jdX/PYc0b/t39P7+epIh6Fc+QRXhyKvUb8PM8T2HKdtgiGhsJWNhHdU/jakPx8EDAdEdkAeX4gEhQkAa3jH/MftdVAv7KMcMXZ1cMYqrtyc+cvRjKpabXqE431pYk8IAm9e8T637nOhZrs4p3FmjJQxMvOkj7dWgmV5KzIox/hjnph+1BNl3avRW6qtbyfE0W+gV36Vkwf7fH3hIJfLze36TelgyXC80+VEVg4k9J8+Qd3etweshnltKLebAMIELuzPN/Mje94RUSgGNWTvb62J2N8IKTL4GjNAXiUeZO13+3DGOCYmhp1f3y8Q6d+hrjQvxb32SbNRI3v3ZtfgEM+1Vigt74X1QpvISptPVWNTKx6gnK3FBc48q4xTYluke+5w6XbnLH9M4UX/GmSR5JNY48vu2PNKF5gB+Ir9MCY8IL0Urq74BzzPQkUPRYIenysMesLLQ/UX+ch9T5f+VOYFJ7r5/HcRwqR9eTzTcYhdtt/TE98bBT8/G9Du4aDnCVA0AO4UqhGj2Q3x1KHW7PB1svACUFSK31cPYplv9c=
  bucket: timeseries-explorer-frontendbucket-1jueporougkwu
